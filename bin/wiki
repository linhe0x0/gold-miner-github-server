#!/usr/bin/env node

const fs = require('fs')
const path = require('path')
const inquirer = require('inquirer')
const axios = require('axios')

const questions = [
  {
    type: 'input',
    name: 'article_url',
    message: 'è¯‘æ–‡é“¾æ¥:',
  },
  {
    type: 'input',
    name: 'article_title',
    message: 'è¯‘æ–‡æ ‡é¢˜:',
  },
  {
    type: 'list',
    name: 'category',
    message: 'è¯‘æ–‡åˆ†ç±»:',
    choices: ['Android', 'iOS', 'å‰ç«¯', 'åç«¯', 'è®¾è®¡', 'äº§å“', 'AI'],
  },
  {
    type: 'input',
    name: 'translation_score',
    message: 'ç¿»è¯‘ç§¯åˆ†:',
  },
  {
    type: 'input',
    name: 'review_score',
    message: 'æ ¡å¯¹ç§¯åˆ†:',
  },
  {
    type: 'input',
    name: 'translator',
    message: 'è¯‘è€…:',
  },
  {
    type: 'input',
    name: 'reviewer[0]',
    message: 'æ ¡å¯¹è€… 1:',
  },
  {
    type: 'input',
    name: 'reviewer[1]',
    message: 'æ ¡å¯¹è€… 2:',
  },
]

const updateWeekly = function updateWeekly(data) {
  const filename = 'weekly.md'

  fs.appendFile(path.resolve(__dirname, filename), `- ${data}\n`, (err) => {
    if (err) return console.error(err)
  })
}

inquirer.prompt(questions).then((answers) => {
  console.log()
  console.log('----------------')
  console.log(`è¯‘æ–‡åˆ†ç±»ï¼š${answers.category}`)
  console.log()
  console.log(`* [${answers.article_title}](${answers.article_url}?utm_source=gold-miner&utm_medium=readme&utm_campaign=github) ([${answers.translator}](https://github.com/${answers.translator}) ç¿»è¯‘)`)
  console.log()
  console.log('----------------')
  console.log('Commit Message: ')
  console.log(`  git commit -a -m ":rocket: æ·»åŠ æ–‡ç« ã€${answers.article_title}ã€åˆ°æ–‡ç« åˆ—è¡¨"`)
  console.log('----------------')
  console.log()

  answers.translation_score -= 0
  answers.review_score -= 0
  answers.reviewer = answers.reviewer.filter(item => item)

  updateWeekly(answers.article_title)

  console.log()
  console.log('weibo:')
  console.log()
  console.log(`#æ˜é‡‘ç¿»è¯‘è®¡åˆ’# ğŸš€ ${answers.article_title} - æ„Ÿè°¢æ˜é‡‘ç¿»è¯‘è®¡åˆ’è¯‘è€… ${answers.translator} çš„åˆ†äº« ğŸºï¼Œå¿«å» @ç¨€åœŸæ˜é‡‘ ä¸€ç¹ä¸ºå¿«å§ï¼š${answers.article_url}ï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡ï¼ŸğŸ‘‰ å¿«æ¥ https://github.com/xitu/gold-miner çœ‹çœ‹å§ã€‚`)
  console.log()

  console.log()
  console.log('zhihu:')
  console.log()
  console.log(`
æ˜é‡‘ç¿»è¯‘è®¡åˆ’æ˜¯ä¸€ä¸ªç¿»è¯‘ä¼˜è´¨äº’è”ç½‘æŠ€æœ¯æ–‡ç« çš„ç¤¾åŒºï¼Œæ–‡ç« æ¥æºä¸ºæ˜é‡‘ä¸Šçš„è‹±æ–‡åˆ†äº«æ–‡ç« ã€‚å†…å®¹è¦†ç›– AIã€Androidã€iOSã€Reactã€å‰ç«¯ã€åç«¯ã€äº§å“ã€è®¾è®¡ç­‰é¢†åŸŸï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šä¼˜è´¨è¯‘æ–‡è¯·æŒç»­å…³æ³¨æ˜é‡‘ç¿»è¯‘è®¡åˆ’ï¼šhttps://github.com/xitu/gold-minerï¼Œå®˜æ–¹å¾®åšè´¦å·ï¼šhttp://weibo.com/juejinfanyi

è¯‘æ–‡ç»´æŠ¤åœ°å€ï¼šï¼Œè¯·è®¿é—® GitHub åŸæ–‡ä»¥è·å–æ›´å¥½çš„é˜…è¯»ä½“éªŒã€‚
`)
  console.log()

  return axios.post('http://127.0.0.1:3000/wiki', answers)
}).then((response) => {
  console.log('Response: ')
  console.log('  ', response.status, response.statusText)
  console.log()
  console.log('è¯‘è€…ç§¯åˆ†è¡¨æœ€æ–°å†å²è®°å½•ï¼š')
  console.log(`https://github.com/xitu/gold-miner/wiki/%E8%AF%91%E8%80%85%E7%A7%AF%E5%88%86%E8%A1%A8/_history`)
})
